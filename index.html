<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frases de películas</title>
    <script src="https://unpkg.com/html5-qrcode" defer></script>
    <style>
        #reader, #image-placeholder {
            width: 300px;
            height: 300px;
            margin: auto;
            display: none;
        }
        #scan-button {
            display: block;
            margin: auto;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #loading-message {
            text-align: center;
            font-size: 18px;
            display: none;
        }
        h1 {
            text-align: center;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <h1>Frases de películas</h1>
    <button id="scan-button">Escanear QR</button>
    <p id="loading-message">Cargando cámara...</p>
    <div id="reader"></div>
    <img id="image-placeholder" src="imagen.png" alt="Escaneado" style="display:none; width: 300px; height: 300px;">
    <audio id="audio-player"></audio>
    
    <script>
        const scanButton = document.getElementById("scan-button");
        const reader = document.getElementById("reader");
        const imagePlaceholder = document.getElementById("image-placeholder");
        const audioPlayer = document.getElementById("audio-player");
        const loadingMessage = document.getElementById("loading-message");

        let html5QrCode;

        scanButton.addEventListener("click", () => {
            scanButton.style.display = "none";
            loadingMessage.style.display = "block"; // Mostrar mensaje de carga
            
            setTimeout(() => {
                reader.style.display = "block"; // Mostrar cámara después de un pequeño retraso
                html5QrCode = new Html5Qrcode("reader");
                
                html5QrCode.start(
                    { facingMode: "environment" },
                    { fps: 10, qrbox: { width: 250, height: 250 } },
                    qrCodeMessage => {
                        html5QrCode.stop().then(() => {
                            reader.style.display = "none";
                            imagePlaceholder.style.display = "block";
                            reproducirAudio(qrCodeMessage);
                        });
                    },
                    errorMessage => {} 
                ).then(() => {
                    loadingMessage.style.display = "none"; // Ocultar mensaje cuando la cámara esté lista
                }).catch(err => {
                    console.log(err);
                    loadingMessage.style.display = "none";
                    scanButton.style.display = "block";
                });

            }, 1000); // Retraso para asegurar que el mensaje de carga se muestre antes de iniciar la cámara
        });

        function reproducirAudio(codigo) {
            let audioSrc = `audio/${codigo}.mp3`;
            audioPlayer.src = audioSrc;
            audioPlayer.play();
            audioPlayer.onended = () => {
                imagePlaceholder.style.display = "none";
                scanButton.style.display = "block";
            };
        }
    </script>
</body>
</html>
